<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini Navigateur</title>
  <style>
    :root { --bg:#0f1720; --panel:#111827; --muted:#9aa4b2; --accent:#0ea5a1; }
    html,body { height:100%; margin:0; font-family:Inter, Arial, sans-serif; background:var(--bg); color:#e6eef3; }
    .app { display:grid; grid-template-columns:220px 1fr; height:100vh; }
    .sidebar { background:var(--panel); padding:12px; border-right:1px solid rgba(255,255,255,0.03); }
    .sidebar h3 { margin:6px 0 10px; font-size:14px; color:var(--muted); }
    .bookmark { display:block; padding:8px; margin-bottom:6px; background:rgba(255,255,255,0.02); border-radius:6px; color:#e6eef3; text-decoration:none; }
    .bookmark:hover { background:rgba(255,255,255,0.03); }
    .main { display:flex; flex-direction:column; }
    .toolbar { display:flex; gap:8px; padding:10px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); }
    .btn { background:transparent; border:1px solid rgba(255,255,255,0.04); color:#e6eef3; padding:6px 10px; border-radius:6px; cursor:pointer; }
    .btn:disabled { opacity:0.4; cursor:default }
    #url { flex:1; padding:8px 10px; border-radius:6px; border:none; background:#0b1220; color:#e6eef3; }
    iframe { border:none; flex:1; width:100%; height:100%; background:white }
    .footer { padding:6px 10px; font-size:12px; color:var(--muted); }
    @media (max-width:700px){ .app{grid-template-columns:1fr} .sidebar{display:none} }
    /* Recherche locale */
    .search-results { position:absolute; top:56px; left:260px; right:20px; background:rgba(11,18,32,0.98); border:1px solid rgba(255,255,255,0.03); border-radius:8px; max-height:260px; overflow:auto; box-shadow:0 6px 18px rgba(0,0,0,0.6); z-index:30; }
    @media (max-width:700px){ .search-results{ left:20px; right:20px; top:110px } }
    .search-item { padding:10px; border-bottom:1px solid rgba(255,255,255,0.02); cursor:pointer; }
    .search-item:last-child{ border-bottom:none }
    .search-item:hover{ background:rgba(255,255,255,0.02); }
    .search-title{ font-weight:600; }
    .search-desc{ color:var(--muted); font-size:13px; margin-top:4px; }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <h3>‚úÖ Favoris</h3>
      <a class="bookmark" href="#" data-url="pages/home.html">Accueil</a>
      <a class="bookmark" href="#" data-url="pages/about.html">√Ä propos</a>
      <a class="bookmark" href="#" data-url="pages/contact.html">Contact</a>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:10px 0">
      <div style="font-size:13px;color:var(--muted)">Astuce: utilisez la barre d'adresse pour saisir une URL ou le chemin local (ex: <code>pages/about.html</code>).</div>
    </aside>

    <main class="main">
      <div class="toolbar" style="position:relative">
        <button class="btn" id="back">‚óÄ</button>
        <button class="btn" id="forward">‚ñ∂</button>
        <button class="btn" id="home">üè†</button>
        <button class="btn" id="reload">‚ü≥</button>
        <input id="url" type="text" placeholder="Rechercher (ex: lebon) ou saisir chemin local (ex: pages/home.html)">
        <button class="btn" id="go">Go</button>
        <div id="searchResults" class="search-results" style="display:none"></div>
      </div>

      <iframe id="navigateur" src=""></iframe>

      <div class="footer" id="footer">Mini Navigateur ‚Äî pages locales et navigation simple</div>
    </main>
  </div>

  <script>
    // Navigation history simple + recherche locale + blocage d'acc√®s externe
    const iframe = document.getElementById('navigateur');
    const input = document.getElementById('url');
    const goBtn = document.getElementById('go');
    const backBtn = document.getElementById('back');
    const forwardBtn = document.getElementById('forward');
    const homeBtn = document.getElementById('home');
    const reloadBtn = document.getElementById('reload');
    const footer = document.getElementById('footer');
    const resultsBox = document.getElementById('searchResults');

    const DEFAULT_HOME = 'pages/home.html';
    let historyStack = [];
    let historyIndex = -1;

    // Index local des pages (titre, mots-cl√©s, description)
    const pagesIndex = [
      { url: 'pages/home.html', title: 'Accueil', keywords: 'accueil home', desc: "Page d'accueil pr√©d√©finie" },
      { url: 'pages/about.html', title: '√Ä propos', keywords: 'apropos about infos', desc: 'Informations sur le mini-navigateur' },
      { url: 'pages/contact.html', title: 'Contact', keywords: 'contact mail email', desc: 'Page de contact pour test' },
      { url: 'pages/le-bon-coin.html', title: 'Le Bon Coin', keywords: 'lebon boncoin annonces', desc: 'Exemple: site d\'annonces (factice)' }
    ];

    function updateButtons(){
      backBtn.disabled = historyIndex <= 0;
      forwardBtn.disabled = historyIndex >= historyStack.length - 1 || historyIndex === -1;
    }

    function showMessage(msg, time = 3000){
      footer.textContent = msg;
      setTimeout(()=>{ footer.textContent = 'Mini Navigateur ‚Äî pages locales et navigation simple'; }, time);
    }

    function isExternal(url){
      // simple d√©tection: pr√©sence d'un sch√©ma ou '//' ou domaine
      return /(^[a-z]+:)|(^\/\/)|([a-z0-9-]+\.[a-z]{2,})/i.test(url) && !url.startsWith('pages/');
    }

    function allowedLocal(url){
      if (!url) return false;
      url = url.trim();
      // exact match in index
      if (pagesIndex.some(p=>p.url.toLowerCase() === url.toLowerCase())) return true;
      // relative path in pages/ and endsWith .html
      if (url.startsWith('pages/') && url.toLowerCase().endsWith('.html')) return true;
      return false;
    }

    function navigate(url, add=true){
      if (!url) return;
      const trimmed = url.trim();
      if (isExternal(trimmed) && !allowedLocal(trimmed)){
        showMessage('‚ö†Ô∏è Acc√®s externe refus√© ‚Äî navigation limit√©e aux pages locales', 4000);
        return;
      }

      // Normaliser : si l'utilisateur a entr√© juste le titre exact, r√©soudre l'URL
      const found = pagesIndex.find(p => p.title.toLowerCase() === trimmed.toLowerCase() || p.url.toLowerCase() === trimmed.toLowerCase());
      const target = found ? found.url : trimmed;

      iframe.src = target;
      input.value = trimmed;

      if (add){
        historyStack = historyStack.slice(0, historyIndex + 1);
        historyStack.push(target);
        historyIndex = historyStack.length - 1;
      }
      updateButtons();
      hideResults();
    }

    // Recherche locale simple
    function searchLocal(query){
      query = (query || '').trim().toLowerCase();
      if (!query) return [];
      const results = pagesIndex.map(p => ({
        p,
        score: ((p.title||'').toLowerCase().includes(query) ? 3 : 0) + ((p.keywords||'').toLowerCase().includes(query) ? 2 : 0) + ((p.desc||'').toLowerCase().includes(query) ? 1 : 0) + ((p.url||'').toLowerCase().includes(query) ? 1 : 0)
      })).filter(r => r.score>0).sort((a,b)=> b.score - a.score).map(r=>r.p);
      return results;
    }

    function showResults(list){
      if (!list || list.length===0){ hideResults(); return; }
      resultsBox.innerHTML = '';
      list.forEach(item => {
        const el = document.createElement('div');
        el.className = 'search-item';
        el.innerHTML = `<div class="search-title">${item.title}</div><div class="search-desc">${item.desc} ‚Äî <code style="color:var(--muted)">${item.url}</code></div>`;
        el.addEventListener('click', ()=>{ navigate(item.url, true); });
        resultsBox.appendChild(el);
      });
      resultsBox.style.display = 'block';
    }

    function hideResults(){ resultsBox.style.display = 'none'; resultsBox.innerHTML = ''; }

    // Buttons & handlers
    goBtn.addEventListener('click', ()=>{ const q = input.value.trim(); const results = searchLocal(q); if(results.length===1) navigate(results[0].url, true); else if (allowedLocal(q)) navigate(q, true); else if (results.length>0) showResults(results); else { showMessage('Aucun r√©sultat local ‚Äî acc√®s externe interdit', 3000); } });

    input.addEventListener('input', (e)=>{
      const q = e.target.value.trim();
      // si l'utilisateur tape un chemin local, masquer les r√©sultats
      if (allowedLocal(q)) { hideResults(); return }
      const results = searchLocal(q);
      if (results.length>0) showResults(results); else hideResults();
    });

    input.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter') { goBtn.click(); }
      if (e.key === 'Escape') { hideResults(); }
    });

    backBtn.addEventListener('click', ()=>{ if(historyIndex>0){ historyIndex--; navigate(historyStack[historyIndex], false); } });
    forwardBtn.addEventListener('click', ()=>{ if(historyIndex < historyStack.length -1){ historyIndex++; navigate(historyStack[historyIndex], false); } });
    homeBtn.addEventListener('click', ()=>{ navigate(DEFAULT_HOME, true); });
    reloadBtn.addEventListener('click', ()=>{ try{ iframe.contentWindow.location.reload(); }catch(e){ iframe.src = iframe.src; } });

    // Favoris (s'assure que la page est locale)
    document.querySelectorAll('.bookmark').forEach(el => {
      el.addEventListener('click', (e)=>{ e.preventDefault(); const url = el.dataset.url; if (allowedLocal(url)) navigate(url, true); else showMessage('Favori non autoris√©'); });
    });

    // Mettre √† jour l'URL quand iframe charge (utile si la page modifie l'historique interne)
    iframe.addEventListener('load', ()=>{
      try{
        const current = iframe.contentWindow.location.href;
        if (current.startsWith('file:')){
          const parts = current.split('/');
          const last = parts.slice(-2).join('/');
          input.value = last; 
        } else {
          input.value = current;
        }
      }catch(e){
        // Cross-origin -> ne pas lire location, garder ce qui est dans input
      }
    });

    // Clic en dehors pour fermer les r√©sultats
    document.addEventListener('click', (e)=>{ if (!e.target.closest('#searchResults') && !e.target.closest('#url')) hideResults(); });

    // Lancer sur la page d'accueil par d√©faut
    navigate(DEFAULT_HOME, true);
  </script>
</body>
</html>
