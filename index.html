<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini Navigateur</title>
  <style>
    :root { --bg:#0f1720; --panel:#111827; --muted:#9aa4b2; --accent:#0ea5a1; }
    html,body { height:100%; margin:0; font-family:Inter, Arial, sans-serif; background:var(--bg); color:#e6eef3; }
    .app { display:grid; grid-template-columns:220px 1fr; height:100vh; }
    .sidebar { background:var(--panel); padding:12px; border-right:1px solid rgba(255,255,255,0.03); }
    .sidebar h3 { margin:6px 0 10px; font-size:14px; color:var(--muted); }
    .bookmark { display:block; padding:8px; margin-bottom:6px; background:rgba(255,255,255,0.02); border-radius:6px; color:#e6eef3; text-decoration:none; }
    .bookmark:hover { background:rgba(255,255,255,0.03); }
    .main { display:flex; flex-direction:column; }
    .toolbar { display:flex; gap:8px; padding:10px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); }
    .btn { background:transparent; border:1px solid rgba(255,255,255,0.04); color:#e6eef3; padding:6px 10px; border-radius:6px; cursor:pointer; }
    .btn:disabled { opacity:0.4; cursor:default }
    #url { flex:1; padding:8px 10px; border-radius:6px; border:none; background:#0b1220; color:#e6eef3; }
    iframe { border:none; flex:1; width:100%; height:100%; background:white }
    .footer { padding:6px 10px; font-size:12px; color:var(--muted); }
    @media (max-width:700px){ .app{grid-template-columns:1fr} .sidebar{display:none} }
    /* Recherche locale */
    .search-results { position:absolute; top:56px; left:260px; right:20px; background:rgba(11,18,32,0.98); border:1px solid rgba(255,255,255,0.03); border-radius:8px; max-height:260px; overflow:auto; box-shadow:0 6px 18px rgba(0,0,0,0.6); z-index:30; }
    @media (max-width:700px){ .search-results{ left:20px; right:20px; top:110px } }
    .search-item { padding:10px; border-bottom:1px solid rgba(255,255,255,0.02); cursor:pointer; }
    .search-item:last-child{ border-bottom:none }
    .search-item:hover{ background:rgba(255,255,255,0.02); }
    .search-title{ font-weight:600; }
    .search-desc{ color:var(--muted); font-size:13px; margin-top:4px; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="left-controls">
      <button class="btn" id="back">‚óÄ</button>
      <button class="btn" id="forward">‚ñ∂</button>
      <button class="btn" id="home">üè†</button>
      <input id="address" class="addr-input" placeholder="Adresse (ex: pages/home.html)" aria-label="Barre d'adresse">
      <button id="addrGo" class="btn">Aller</button>
    </div>
    <div class="right-controls">
      <button id="reload" class="btn">‚ü≥</button>
    </div>
  </div>

  <div class="center">
    <div class="logo">Mini Navigateur</div>
    <div style="color:#5f6368">Recherchez dans les pages locales</div>
    <div class="search-large">
      <input id="mainSearch" class="search-input" placeholder="Rechercher (ex: lebon)">
      <button id="searchBtn" class="search-btn">Recherche</button>
    </div>
  </div>

  <div class="content">
    <iframe id="navigateur" src=""></iframe>
  </div>

  <div class="footer" id="footer">Navigation limit√©e aux pages locales</div>

  <script>
    // Comportement: barre du haut = adresses pr√©cises (ouvrir page locale)
    // champ central = recherche non pr√©cise => si 1 r√©sultat ouvrir la page, sinon ouvrir page de r√©sultats

    const iframe = document.getElementById('navigateur');
    const address = document.getElementById('address');
    const addrGo = document.getElementById('addrGo');
    const backBtn = document.getElementById('back');
    const forwardBtn = document.getElementById('forward');
    const homeBtn = document.getElementById('home');
    const reloadBtn = document.getElementById('reload');
    const mainSearch = document.getElementById('mainSearch');
    const searchBtn = document.getElementById('searchBtn');
    const footer = document.getElementById('footer');

    const DEFAULT_HOME = 'pages/home.html';
    let historyStack = [];
    let historyIndex = -1;

    // Index local (titres, mots-cl√©s, descriptions)
    const pagesIndex = [
      { url: 'pages/home.html', title: 'Accueil', keywords: 'accueil home', desc: "Page d\'accueil" },
      { url: 'pages/le-bon-coin.html', title: 'Le Bon Coin', keywords: 'lebon boncoin annonces', desc: 'Exemple: site d\'annonces (factice)' }
    ];

    function isExternal(url){
      return /(^[a-z]+:)|(^\/\/)|([a-z0-9-]+\.[a-z]{2,})/i.test(url) && !url.startsWith('pages/');
    }

    function allowedLocal(url){
      if(!url) return false;
      url = url.trim();
      if (pagesIndex.some(p => p.url.toLowerCase() === url.toLowerCase())) return true;
      if (url.startsWith('pages/') && url.toLowerCase().endsWith('.html')) return true;
      return false;
    }

    function navigate(url, add=true){
      if(!url) return;
      if (isExternal(url) && !allowedLocal(url)) { showMessage('‚ö†Ô∏è Acc√®s externe refus√©'); return; }
      iframe.src = url;
      address.value = url;
      if (add) { historyStack = historyStack.slice(0, historyIndex+1); historyStack.push(url); historyIndex = historyStack.length - 1; }
      updateNavButtons();
    }

    function updateNavButtons(){
      backBtn.disabled = historyIndex <= 0;
      forwardBtn.disabled = historyIndex >= historyStack.length -1 || historyIndex === -1;
    }

    function showMessage(msg, time=3000){
      footer.textContent = msg;
      setTimeout(()=> footer.textContent = 'Navigation limit√©e aux pages locales', time);
    }

    function searchLocal(q){
      q = (q||'').trim().toLowerCase();
      if(!q) return [];
      return pagesIndex.map(p => ({p,score:((p.title||'').toLowerCase().includes(q)?3:0)+((p.keywords||'').toLowerCase().includes(q)?2:0)+((p.desc||'').toLowerCase().includes(q)?1:0)+((p.url||'').toLowerCase().includes(q)?1:0)})).filter(r => r.score>0).sort((a,b)=>b.score-a.score).map(r=>r.p);
    }

    // Top address handlers (pr√©cise)
    addrGo.addEventListener('click', ()=>{
      const v = address.value.trim();
      if(!v) return;
      if (allowedLocal(v)) navigate(v, true);
      else showMessage('Adresse non autoris√©e (seules pages locales)',4000);
    });
    address.addEventListener('keydown', (e)=>{ if(e.key==='Enter') addrGo.click(); });

    // Recherche centrale (non pr√©cise)
    searchBtn.addEventListener('click', ()=>{
      const q = mainSearch.value.trim();
      if(!q) return;
      const results = searchLocal(q);
      if (results.length===1){ navigate(results[0].url, true); }
      else {
        // ouvrir la page de r√©sultats et transmettre la query
        navigate('pages/search-results.html?q='+encodeURIComponent(q), true);
      }
    });
    mainSearch.addEventListener('keydown', (e)=>{ if(e.key==='Enter') searchBtn.click(); });

    // Navigation buttons
    backBtn.addEventListener('click', ()=>{ if(historyIndex>0){ historyIndex--; navigate(historyStack[historyIndex], false); } });
    forwardBtn.addEventListener('click', ()=>{ if(historyIndex < historyStack.length -1){ historyIndex++; navigate(historyStack[historyIndex], false); } });
    homeBtn.addEventListener('click', ()=>{ navigate(DEFAULT_HOME, true); });
    reloadBtn.addEventListener('click', ()=>{ try{ iframe.contentWindow.location.reload(); }catch(e){ iframe.src = iframe.src; } });

    // Mettre √† jour le champ adresse quand l'iframe change (local only)
    iframe.addEventListener('load', ()=>{
      try{
        const current = iframe.contentWindow.location.href;
        if (current.startsWith('file:')){
          const parts = current.split('/');
          const last = parts.slice(-2).join('/');
          address.value = last;
        } else { address.value = current; }
      }catch(e){ /* cross-origin - ignore */ }
    });

    // D√©marre sur l'accueil
    navigate(DEFAULT_HOME, true);
  </script>
</body>
</html>
